![Screenshot from 2023-09-19 15-27-35](https://github.com/KKiranR/Pes_pd/assets/89727621/5f59a82d-b47f-45f7-84c6-8403ee77b473)# DAY 4
## Pre-layout timing analysis and importance of good clock tree
### Timing Modelling using Delay Tables
Place and routing (PnR) is performed using an abstract view of the GDS files generated by Magic. The PnR tool will use the abstract view information, formally defined as LEF information, to perform interconnect routing. From PnR POV, We have to follow certain guidelines to get standard cell set

Input and output ports must lie on the intersection of vertical and horizontal tracks Width of the standard cell should be odd multiples of the track pitch and height should be odd multiple of vertical track pitch

**steps to convert grid info to track info**
path is ```Desktop/work/tools/openlane_working_dir/pdks/sky130A/libs.tech/openlane/sky130fd_sc_hd```
Now to open the track info file use ```gedit track.info```

![image](https://github.com/KKiranR/Pes_pd/assets/89727621/ee7c36d8-6a50-41f0-9c74-c595d7214759)
- The tracks.info file is used during routing.
- Routes are the metal traces.
1st numeric column indicates the offset and 2nd indicates the pitch along provided direction

Setting grid values

use the command in the magic console ``` grid 0.46um 0.34um 0.23um 0.17um```

To write the inverter into a lef file use command ```write lef```

![Screenshot from 2023-09-19 12-37-04](https://github.com/KKiranR/Pes_pd/assets/89727621/69f55899-1fe3-4364-a466-2c144518f324)
**Synthesis Using the designed Inverter**
1)Copy the lef file created to the directory of picorv32a using the command
``` bash
cp sky_130_vsdinv.lef /home/vsduser/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/src
```
2)now copy the lib files into the src folder using command
``` bash
cp sky130_fd_sc_hd__* /home/vsduser/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/src
```
3)Modify the config file in the picorv32a as follows
``` bash=?

# Design
set ::env(DESIGN_NAME) "picorv32a"

set ::env(VERILOG_FILES) "./designs/picorv32a/src/picorv32a.v"
set ::env(SDC_FILE) "./designs/picorv32a/src/picorv32a.sdc"

set ::env(CLOCK_PERIOD) "12.000"
set ::env(CLOCK_PORT) "clk"


set ::env(CLOCK_NET) $::env(CLOCK_PORT)


set ::env(LIB_SYNTH) "$::env(OPENLANE_ROOT)/designs/picorv32a/src/sky130_fd_sc_hd__typical.lib"

set ::env(LIB_FASTEST) "$::env(OPENLANE_ROOT)/designs/picorv32a/src/sky130_fd_sc_hd__fast.lib"
set ::env(LIB_SLOWEST) "$::env(OPENLANE_ROOT)/designs/picorv32a/src/sky130_fd_sc_hd__slow.lib"
set ::env(LIB_TYPICAL) "$::env(OPENLANE_ROOT)/designs/picorv32a/src/sky130_fd_sc_hd__typical.lib"
set ::env(EXTRA_LEFS) [glob $::env(OPENLANE_ROOT)/designs/$::env(DESIGN_NAME)/src/*.lef]
set filename $::env(OPENLANE_ROOT)/designs/$::env(DESIGN_NAME)/$::env(PDK)_$::env(STD_CELL_LIBRARY)_config.tcl
if { [file exists $filename] == 1} {
	source $filename
}

```
4)Run the synthesis 

![Screenshot from 2023-09-19 12-55-36](https://github.com/KKiranR/Pes_pd/assets/89727621/97d1ba98-ea4a-4a26-925f-56209fe0f592)

![Screenshot from 2023-09-19 12-55-47](https://github.com/KKiranR/Pes_pd/assets/89727621/c206e78e-c033-475e-b88c-2b612d50891d)

5)Run floorplan and routing and view the schematic by commands used in day3

![Screenshot from 2023-09-19 13-01-11](https://github.com/KKiranR/Pes_pd/assets/89727621/baffc89a-b431-44a7-92b7-59466b2343b2)
![Screenshot from 2023-09-19 13-00-54](https://github.com/KKiranR/Pes_pd/assets/89727621/4c80e29b-fbdf-42c7-8dc4-ba23f63498a4)

![Screenshot from 2023-09-22 16-01-02](https://github.com/KKiranR/Pes_pd/assets/89727621/9e374835-b5c4-4d2a-8c66-8f11850510ad)

## Timming Analysis with Ideal Clock using Open STA
Configure OpenSTA for Post-Synth Timing Analysis
- Create two files pre_sta.conf and my_base.sdc in the directory ```/home/vsduser/Desktop/work/tools/openlane_workiing_dir/openlane ```  and in ```/home/vsduser/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/src/sky130``` respectively
pre_sta.conf as follows
``` bash
set_cmd_units -time ns -capacitance pF -current mA -voltage V -resistance kOhm -distance um
read_liberty -max /home/vsduser/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/src/sky130/sky130_fd_sc_hd__slow.lib
read_liberty -min /home/vsduser/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/src/sky130/sky130_fd_sc_hd__fast.lib
read_verilog /home/vsduser/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/19-09_07-17/results/synthesis/picorv32a.synthesis.v
link_design picorv32a
read_sdc /home/vsduser/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/src/sky130/my_base.sdc
report_checks -path_delay min_max -fields {slew trans net cap input_pin}
report_tns
report_wns
```
my_base.sdc as follows
``` bash
set ::env(CLOCK_PORT) clk
set ::env(CLOCK_PERIOD) 12.000

set ::env(SYNTH_DRIVING_CELL) sky130_fd_sc_hd__inv_8
set ::env(SYNTH_DRIVING_CELL_PIN) Y
set ::env(SYNTH_CAP_LOAD) 17.65
set ::env(SYNTH_MAX_FANOUT) 4

create_clock [get_ports $::env(CLOCK_PERIOD)] -name $::env(CLOCK_PORT) -period $::env(CLOCK_PERIOD)
set IO_PCT 0.2
set input_delay_value [expr $::env(CLOCK_PERIOD) * $IO_PCT]
set output_delay_value [expr $::env(CLOCK_PERIOD) * $IO_PCT]
puts "\[INFO\]: Setting output delay to : $output_delay_value"
puts "\[INFO\]: Setting input delay to : $input_delay_value"

set_max_fanout $::env(SYNTH_MAX_FANOUT) [current_design]

set clk_indx [lsearch [all_inputs] [get_port $::env(CLOCK_PORT)]]
set all_inputs_wo_clk [lreplace [all_inputs] $clk_indx $clk_indx]
set all_inputs_wo_clk_rst $all_inputs_wo_clk



set_input_delay $input_delay_value  -clock [get_clocks $::env(CLOCK_PORT)] $all_inputs_wo_clk_rst
set_output_delay $output_delay_value -clock [get_clocks $::env(CLOCK_PORT)] [all_outputs]


set_driving_cell -lib_cell $::env(SYNTH_DRIVING_CELL) -pin $::env(SYNTH_DRIVING_CELL_PIN) [all_inputs]
set cap_load [expr $::env(SYNTH_CAP_LOAD) / 1000.0]
puts "\[INFO\]: Setting load to: $cap_load"
set_load $cap_load [all_outputs]
```
TO run sta run command ```sta pre_sta.conf```

![Screenshot from 2023-09-19 15-27-35](https://github.com/KKiranR/Pes_pd/assets/89727621/92d74f84-4461-4b7a-9d06-bc6ae15bcf6d)


## Clock Tree Synthesis TritonCTS and Signal Integrity

- To run clock tree synthesis use command ```run_cts``` after runing this a new .v is created
  
**running openSTA using real clocks**
- first type the command ```openroad```
-  Then enter command
  ```bash
read_lef /openLANE_flow/designs/picorv32a/runs/19-09_10-6/tmp/merged.lef
read_def /openLANE_flow/designs/picorv32a/runs/19-09_10-6/results/cts/picorv32a.cts.def
write_db pico_cts.db
read_db pico_cts.db
read_verilog /openLANE_flow/designs/picorv32a/runs/19-09_10-6/results/synthesis/picorv32a.synthesis_cts.v
read_liberty -max $::env(LIB_SLOWEST)
read_liberty -max $::env(LIB_FASTEST)
read_sdc /openLANE_flow/designs/picorv32a/src/sky130/my_base.sdc
set_propagated_clock [all_clocks]
report_checks -path_delay min_max -format full_clock_expanded -digits 4
```

![Screenshot from 2023-09-19 15-27-35](https://github.com/KKiranR/Pes_pd/assets/89727621/54356d44-ae73-4e88-afe0-c820d9cee7ec)

![Screenshot from 2023-09-19 16-04-20](https://github.com/KKiranR/Pes_pd/assets/89727621/e1ac0a2d-8b23-46d7-939b-41fd7390eaa9)
